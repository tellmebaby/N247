<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.first.mvc.BaseMapper">
 
 
  <select id="getCountId" resultType="integer">
    SELECT count(*) id FROM hong.iamkayList where id
  </select>
  
  <insert id="insertFile" parameterType="org.first.mvc.entity.Upload">
    insert into hong.N247_up (hong.N247_up.create,hong.N247_up.lastModified,up_fileName,up_isDel,up_userId,up_postId,up_tabId) values (now(),now(),#{up_fileName},0,#{up_userId},#{up_postId},#{up_tabId})
  </insert>
  
  <insert id="insertPost" parameterType="org.first.mvc.entity.Post">
    insert into hong.N247 (hong.N247.create,postTitle,description,tabId,isDel,hong.N247.lastUpdate, userNum, dueDay) values (now(),#{postTitle},#{description},#{tabId},0,now(),#{userNum},#{dueDay})
  </insert>
  
  <insert id="insertTab" parameterType="org.first.mvc.entity.Post">
    insert into hong.N247_tab (hong.N247_tab.create,hong.N247_tab.lastUpdate,tabTitle,isDel,userNum,tab_intro,tab_dueDay) values (now(),now(),#{tabTitle},0,#{userNum},#{tab_intro},#{tab_dueDay})
  </insert>
  <insert id="insertMember" parameterType="org.first.mvc.entity.Member">
    insert into hong.member (hong.member.create,id,nickName,password,passwordConfirm,role,hong.member.modified) values (now(),#{id},#{nickName},#{password},#{passwordConfirm},#{role},now())
  </insert>
  <insert id="subFri" parameterType="org.first.mvc.entity.Fn247">
    insert into hong.N247_f (hong.N247_f.create,fUserId,ftabId,f_isDel,myId,adm) values (now(),#{fUserId},0,0,#{myId},0);
  </insert>
  <insert id="subFriTab" parameterType="org.first.mvc.entity.Fn247">
    insert into hong.N247_ft (hong.N247_ft.create,ft_tabId,ft_userId,ft_isDel,hong.N247_ft.lastModified) values (now(),#{ft_tabId},#{ft_userId},0,now());
  </insert>
  <insert id="insertReply" parameterType="org.first.mvc.entity.Post">
    INSERT INTO hong.N247_re (N247_rePoId,N247_reUsId,N247_reDes,hong.N247_re.create,hong.N247_re.lastModified,N247_reIsDel,N247_reTabId) VALUE (#{n247_rePoId},#{n247_reUsId},#{n247_reDes},now(),now(),0,#{N247_reTabId});
  </insert>
  
  
  <select id="getFriImgList" resultType="org.first.mvc.entity.Post">
  	select N247_reUsId from hong.N247_re where N247_rePoId = #{N247_rePoId} AND N247_reDu = 1
  </select>
  <select id="getFriendList" resultType="org.first.mvc.entity.Fn247">
  	SELECT * FROM hong.N247_f Where myId = #{myId} AND f_isDel=0 OR fUserId = #{myId} AND f_isDel=0
  </select>
  <select id="getPostList" resultType="org.first.mvc.entity.Post">
    select * from hong.N247 where tabId = #{tabId} AND isDel = 0 OR tabId = #{tabId} AND isDel = 3 order by lastUpdate desc
  </select>
  <select id="getPostId" resultType="org.first.mvc.entity.Post">
    select id from hong.N247 where tabId = #{tabId} AND isDel = 0 order by lastUpdate desc
  </select>
  <select id="getReplyList" resultType="org.first.mvc.entity.Post">
    SELECT * FROM hong.N247_re WHERE N247_rePoId = #{N247_rePoId} AND N247_reIsDel = 0 order by lastModified desc
  </select>
  
  <select id="getReplyListToTabId" resultType="org.first.mvc.entity.Post">
   SELECT * FROM hong.N247_re WHERE N247_reTabId = #{tabId} AND N247_reIsDel = 0 order by lastModified desc 
  </select>
  <select id="getUserImg" resultType="String">
    SELECT up_fileName FROM hong.N247_up Where up_userId = #{userNum} and up_isDel = 0 and up_postId = 0 
  </select>
  <select id="getUserImgToPost" resultType="org.first.mvc.entity.Post">
    SELECT * FROM hong.N247_up Where up_postId = #{up_postId} AND up_isDel = 0 order by lastModified desc
  </select>
  <select id="getIdn247_up" resultType="Integer">
    SELECT idN247_up FROM hong.N247_up Where up_userId = #{up_userId} and up_isDel = 0 and up_postId = 0 
  </select>
  <select id="getTabList" resultType="org.first.mvc.entity.Post">
    select * from hong.N247_tab where userNum = #{userNum} AND isDel = 0 order by lastUpdate desc
  </select>
  <select id="getTabIntro" resultType="string">
    SELECT tab_intro from hong.N247_tab where tabId = #{tabId} AND isDel = 0
  </select>
  
  <select id="getAdmFriTabId" resultType="org.first.mvc.entity.Fn247">
    SELECT ft_tabId FROM hong.N247_ft Where ft_userId = #{ft_userId} AND ft_isDel = 0 
  </select>
   <select id="getAdmFriTabList" resultType="org.first.mvc.entity.Post">
    SELECT * From hong.N247_tab Where tabId = #{tabId} AND isDel = 0
  </select>
  <select id="countIdCheck" resultType="Integer">
    select count(*) from hong.N247 where tabId = #{tabId}
  </select>
   <select id="getUserIntroduce" resultType="String">
    select mb_introduce from hong.member where userId = #{userId}
  </select>
  <select id="countReIdCheck" resultType="Integer">
    select count(*) from hong.N247_re where N247_rePoId = #{N247_rePoId}
  </select>
  <select id="memberCheck" resultType="Integer">
  	select count(*) from hong.N247_member where #{check} = #{check}
  </select>
  <select id="getPostFileCheck" resultType="Integer">
  	SELECT count(*) from hong.N247_up Where up_postId = #{up_postId} and up_isDel = 0 
  </select>
  
  <select id="getPostFileToTabId" resultType="org.first.mvc.entity.Upload">
  	SELECT * FROM hong.N247_up WHERE up_tabId = #{tabId} and up_isDel = 0 order by lastModified desc
  </select>
  <select id="getFriList" resultType="org.first.mvc.entity.Fn247">
  	select * FROM hong.N247_f Where myId = #{myId} and f_isDel = 0 and adm = #{adm}
  </select>
    <select id="getFriAdmList" resultType="org.first.mvc.entity.Fn247">
  	select * FROM hong.N247_f Where fUserId = #{myId} and f_isDel = 0 and adm = #{adm}
  </select>
  <select id="getFriAdmTabId" resultType="org.first.mvc.entity.Fn247">
  	SELECT * FROM hong.N247_ft Where ft_tabId = #{ft_tabId} and ft_isDel = 0
  </select>
   <select id="getFriAdmIdN247_ft" resultType="Integer">
  	 select idN247_ft from hong.N247_ft where ft_userId = #{ft_userId} AND ft_tabId = #{ft_tabId} AND ft_isDel = 0
  </select>
  <select id="getReFriList" resultType="org.first.mvc.entity.Fn247">
  	select * FROM hong.N247_f Where fUserId = #{myId} and f_isDel = 0 and adm = 0
  </select>
  
  <select id="countIdPsw" resultType="Integer">
    select count(*) from hong.member where id = #{id} and password = #{password}
  </select>
  <select id="countId" resultType="Integer">
    select count(*) from member where id = #{id}
  </select>
    <select id="countfUserId" resultType="Integer">
  	SELECT count(*) FROM hong.N247_f where fUserId = #{fUserId} AND f_isDel = 0 AND myId = #{myId}
  </select>
  <select id="countNick" resultType="Integer">
    select count(*) from hong.member where nickName = #{nickName}
  </select>
  <select id="countTab" resultType="Integer">
  	select count(*) from hong.N247_tab where userNum = #{userNum} AND isDel = 0
  </select>
   <select id="countFriTab" resultType="Integer">
  	select count(*) from hong.N247_ft where ft_userId = #{userNum} AND ft_isDel = 0
  </select>
  <select id="countFriId" resultType="Integer">
  	select count(*) from hong.N247_ft where ft_userId = #{ft_userId} AND ft_tabId = #{ft_tabId} AND ft_isDel = 0 
  </select>
  <select id="countFt" resultType="Integer">
  	select count(*) from hong.N247_ft where ft_tabId = #{ft_tabId} AND ft_isDel = 0 
  </select>

 
  
  <select id="getMemberNick" resultType="String">
    select nickName from hong.member where id = #{id}
  </select>
  <select id="getNickNameToUserNum" resultType="String">
  	select nickName from hong.member where userId = #{userNum}
  </select>
  <select id="getIdToUserNum" resultType="String">
  	select id from hong.member where userId = #{userNum}
  </select>
  <select id="getMember" resultType="org.first.mvc.entity.Member">
  	select id,nickName,mb_introduce,userImg,userId from hong.member where userId = #{userId}
  </select>
  <select id="getMemberToId" resultType="org.first.mvc.entity.Member">
  	select id,nickName,mb_introduce,userImg,userId from hong.member where id = #{id}
  </select>
  <select id="getUserNum" resultType="Integer">
  	select userId from hong.member where id = #{id}
  </select>
  <select id="getNickToTabId" resultType="String">
    select nick from hong.N247_tab where tabId = #{tabId}
  </select>
  
  <select id="getUserNumToTabId" resultType="Integer">
  	select userNum from hong.N247_tab where tabId = #{tabId}
  </select>
  <select id="getTab" resultType="org.first.mvc.entity.Post">
    select * from hong.N247_tab where tabId = #{tabId}
  </select>
  <select id="getTabLastUpdate" resultType="org.first.mvc.entity.Post">
    select lastUpdate from hong.N247_tab where tabId = #{tabId}
  </select>
  <select id="getTabDueDay" resultType="org.first.mvc.entity.Post">
    select tab_dueDay from hong.N247_tab where tabId = #{tabId}
  </select>
  <select id="getTabInfor" resultType="org.first.mvc.entity.Post">
    select * from hong.N247_tab where tabId = #{tabId}
  </select>
  <select id="getPostLastUpdate" resultType="org.first.mvc.entity.Post">
    select lastUpdate from hong.N247 where tabId = #{tabId} order by lastUpdate desc
  </select>
  <select id="getTabTitleToTabId" resultType="String">
    select tabTitle from hong.N247_tab where tabId = #{tabId}
  </select>
   <select id="getTabId" resultType="org.first.mvc.entity.Post">
    select * from hong.N247_tab where tabTitle = #{tabTitle}
  </select>
  <select id="getLastUseTabId" resultType="org.first.mvc.entity.Post">
    select * hong.N247_tab where nick = #{nick} AND isDel = 0 order by lastUpdate desc
  </select>
  <select id="getSecondTabId" resultType="org.first.mvc.entity.Post">
    select * from hong.N247_tab Where userNum = #{userNum} AND isDel = 0 order by lastUpdate desc
  </select>

  <select id="nicktotabId" resultType="org.first.mvc.entity.Post">
  	select nick from hong.N247_tabId where tabId = #{tabId}
  </select>
  

   <delete id="deletePost" parameterType="Integer">
    delete from hong.N247 where id=#{id}
  </delete>


  <update id="updateTabTitle" parameterType="org.first.mvc.entity.Post">
    update hong.N247_tab set tabTitle=#{tabTitle},hong.N247_tab.lastUpdate=now() where tabId=#{tabId}
  </update>
  <update id="updateIsDelPost" parameterType="org.first.mvc.entity.Post">
    update hong.N247 set isDel=1 , hong.N247.lastUpdate = now() where id=#{id}
  </update>
  <update id="updateCompletePost" parameterType="org.first.mvc.entity.Post">
    update hong.N247 set isDel=#{isDel} , hong.N247.lastUpdate = now() where id=#{id}
  </update>
  <update id="updateTabIntro" parameterType="org.first.mvc.entity.Post">
    update hong.N247_tab set tab_intro=#{tab_intro},hong.N247_tab.lastUpdate=now() where tabId=#{tabId}
  </update>
  <update id="updateTabDueDay" parameterType="org.first.mvc.entity.Post">
    update hong.N247_tab set tab_dueDay=#{tab_dueDay},hong.N247_tab.lastUpdate=now() where tabId=#{tabId}
  </update>
   <update id="updateIsDelPostfile" parameterType="org.first.mvc.entity.Post">
    update hong.N247_up set up_isDel=1 where up_postId=#{id}
  </update>
    <update id="updateIsDelTabTitle" parameterType="org.first.mvc.entity.Post">
    update hong.N247_tab set isDel=#{isDel} where tabId=#{tabId}
  </update>
   <update id="updatePostTabTitle" parameterType="org.first.mvc.entity.Post">
    update hong.N247 set tabId=#{tabId} where tabId=#{moveOn}
  </update>
  <update id="updateAllPostIsDeltoTabId" parameterType="org.first.mvc.entity.Post">
    update hong.N247 set isDel=1 where tabId=#{tabId}
  </update>
   <update id="updatePost" parameterType="org.first.mvc.entity.Post">
    update hong.N247 set hong.N247.lastUpdate = now(), postTitle = #{postTitle} , description = #{description} , tabId = #{tabId} , dueDay = #{dueDay} where id = #{id}
  </update>
   <update id="updateFriAdm" parameterType="org.first.mvc.entity.Fn247">
    UPDATE hong.N247_f set adm = 1 where idN247_f = #{idN247_f}; 
  </update>
  <update id="updateDelFri" parameterType="org.first.mvc.entity.Fn247">
    UPDATE hong.N247_f set f_isDel = 1 where idN247_f = #{idN247_f}; 
  </update>
  <update id="updateDelFriToTab" parameterType="org.first.mvc.entity.Fn247">
    UPDATE hong.N247_ft set ft_isDel = 1 , hong.N247_ft.lastModified = now() where idN247_ft = #{idN247_ft}; 
  </update>
  <update id="updateReply" parameterType="org.first.mvc.entity.Post">
    UPDATE hong.N247_re SET N247_reDes = #{n247_reDes} , hong.N247_re.lastModified = now() WHERE idN247_re = #{idN247_re}
  </update>
  <update id="updateMemberIntroduce" parameterType="org.first.mvc.entity.Member">
    UPDATE hong.member set nickName = #{nickName} ,mb_introduce = #{mb_introduce} , hong.member.modified = now() where userId = #{userId}
  </update>
  <update id="updateUploadDel" parameterType="org.first.mvc.entity.Upload">
    UPDATE hong.N247_up set up_isDel = 1 where idN247_up = #{idN247_up};
  </update>

</mapper>